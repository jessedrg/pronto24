import { NextResponse } from "next/server"

export const dynamic = "force-dynamic"

const CITIES = [
  // Catalunya - Barcelona
  "barcelona",
  "hospitalet-llobregat",
  "badalona",
  "terrassa",
  "sabadell",
  "mataro",
  "santa-coloma-gramenet",
  "cornella-llobregat",
  "sant-boi-llobregat",
  "rubi",
  "manresa",
  "vilanova-geltru",
  "viladecans",
  "castelldefels",
  "el-prat-llobregat",
  "granollers",
  "cerdanyola-valles",
  "mollet-valles",
  "gava",
  "esplugues-llobregat",
  "sant-cugat-valles",
  "sant-feliu-llobregat",
  "vic",
  "igualada",
  "ripollet",
  "sant-adria-besos",
  "montcada-reixac",
  "sant-pere-ribes",
  "sitges",
  "martorell",
  "pineda-mar",
  "sant-joan-despi",
  "premia-mar",
  "calella",
  "el-masnou",
  "mongat",
  "malgrat-mar",
  "arenys-mar",
  "canet-mar",
  "cardedeu",
  "molins-rei",
  "sant-vicenc-dels-horts",
  "palleja",
  "barbera-valles",
  "santa-perpetua-mogoda",
  "llinars-valles",
  "la-garriga",
  "caldes-montbui",
  "parets-valles",
  "montmelo",
  "la-llagosta",
  "santa-maria-palautordera",
  "tordera",
  "blanes",
  "lloret-mar",
  "sant-andreu-barca",
  "corbera-llobregat",
  "cervello",
  "olesa-montserrat",
  "abrera",
  "esparreguera",
  "castellbisbal",
  "sant-esteve-sesrovires",
  "gelida",
  "sant-sadurni-anoia",
  "vilafranca-penedes",
  "el-vendrell",
  "calafell",
  "torredembarra",
  "altafulla",
  "cunit",
  "cubelles",
  "vilassar-mar",
  "cabrera-mar",
  "argentona",
  "dosrius",
  "la-roca-valles",
  "vallirana",
  "begues",
  "torrelles-llobregat",
  "sant-climent-llobregat",
  "sant-just-desvern",
  // Catalunya - Girona
  "girona",
  "figueres",
  "olot",
  "salt",
  "palafrugell",
  "sant-feliu-guixols",
  "roses",
  "banyoles",
  "la-bisbal-emporda",
  "palamos",
  "torroella-montgri",
  "ripoll",
  "lescala",
  "castello-empuries",
  "cadaques",
  "llanca",
  "portbou",
  "puigcerda",
  "camprodon",
  "tossa-mar",
  "calonge",
  "platja-daro",
  "sant-antoni-calonge",
  "begur",
  "pals",
  "tamariu",
  "llafranc",
  "calella-palafrugell",
  "aiguablava",
  // Catalunya - Tarragona
  "tarragona",
  "reus",
  "tortosa",
  "cambrils",
  "salou",
  "valls",
  "amposta",
  "vila-seca",
  "mont-roig-camp",
  "miami-platja",
  "lametlla-mar",
  "deltebre",
  "sant-carles-rapita",
  "lhospitalet-infant",
  "vandellòs",
  // Catalunya - Lleida
  "lleida",
  "balaguer",
  "tarrega",
  "mollerussa",
  "la-seu-urgell",
  "solsona",
  "cervera",
  "tremp",
  "sort",
  "vielha",
  "les",
  "bossost",
  "el-pont-suert",
  // Madrid
  "madrid",
  "mostoles",
  "alcala-henares",
  "fuenlabrada",
  "leganes",
  "getafe",
  "alcorcon",
  "torrejon-ardoz",
  "parla",
  "alcobendas",
  "las-rozas",
  "pozuelo-alarcon",
  "coslada",
  "rivas-vaciamadrid",
  "valdemoro",
  "majadahonda",
  "collado-villalba",
  "aranjuez",
  "arganda-rey",
  "boadilla-monte",
  "pinto",
  "colmenar-viejo",
  "tres-cantos",
  "san-sebastian-reyes",
  "san-fernando-henares",
  "torrelaguna",
  "ciempozuelos",
  "humanes-madrid",
  "villanueva-canada",
  "el-escorial",
  "san-lorenzo-escorial",
  "torrelodones",
  "galapagar",
  "alpedrete",
  "guadarrama",
  "moralzarzal",
  "becerril-sierra",
  "cercedilla",
  "navacerrada",
  "brunete",
  "villanueva-pardillo",
  "villaviciosa-odon",
  "navalcarnero",
  "griñon",
  "cubas-sagra",
  "casarrubuelos",
  "torrejon-velasco",
  "morata-tajuña",
  "chinchon",
  "colmenar-oreja",
  "villaconejos",
  "titulcia",
  "san-martin-vega",
  "ciempozuelos",
  // Andalucia - Malaga
  "malaga",
  "marbella",
  "mijas",
  "fuengirola",
  "torremolinos",
  "benalmadena",
  "estepona",
  "velez-malaga",
  "rincon-victoria",
  "antequera",
  "ronda",
  "nerja",
  "alhaurin-torre",
  "coin",
  "alhaurin-grande",
  "cartama",
  "san-pedro-alcantara",
  "nueva-andalucia",
  "puerto-banus",
  "benahavis",
  "manilva",
  "casares",
  "gaucin",
  "ojen",
  "monda",
  "tolox",
  "alora",
  "pizarra",
  "ardales",
  "campillos",
  "teba",
  "sierra-yeguas",
  "mollina",
  "humilladero",
  "alameda",
  "cuevas-san-marcos",
  "villanueva-trabuco",
  "archidona",
  "villanueva-tapia",
  "torre-mar",
  "algarrobo",
  "torrox",
  "competa",
  "frigiliana",
  "sayalonga",
  "canillas-aceituno",
  "sedella",
  "salares",
  "archez",
  "corumbela",
  // Andalucia - Sevilla
  "sevilla",
  "dos-hermanas",
  "alcala-guadaira",
  "utrera",
  "mairena-aljarafe",
  "ecija",
  "la-rinconada",
  "carmona",
  "coria-rio",
  "san-juan-aznalfarache",
  "tomares",
  "bormujos",
  "gines",
  "castilleja-cuesta",
  "espartinas",
  "olivares",
  "sanlucar-mayor",
  "camas",
  "gelves",
  "mairena-vega",
  "santiponce",
  "la-algaba",
  "lora-rio",
  "lebrija",
  "moron-frontera",
  "osuna",
  "marchena",
  "arahal",
  "paradas",
  "el-viso-alcor",
  "mairena-alcor",
  // Andalucia - Granada
  "granada",
  "motril",
  "armilla",
  "almunecar",
  "loja",
  "baza",
  "guadix",
  "santa-fe",
  "maracena",
  "las-gabias",
  "huetor-vega",
  "monachil",
  "peligros",
  "atarfe",
  "albolote",
  "chauchina",
  "fuente-vaqueros",
  "salobrena",
  "castell-ferro",
  "la-herradura",
  "orgiva",
  "lanjaron",
  "pampaneira",
  "capileira",
  "trevelez",
  "bubion",
  "pitres",
  // Andalucia - Cordoba
  "cordoba",
  "lucena",
  "puente-genil",
  "montilla",
  "priego-cordoba",
  "cabra",
  "palma-rio",
  "baena",
  "la-carlota",
  "penarroya-pueblonuevo",
  "pozoblanco",
  "villanueva-cordoba",
  "hinojosa-duque",
  "belmez",
  "espiel",
  "fuente-obejuna",
  "pedroche",
  "dos-torres",
  "villaralto",
  "santa-eufemia",
  // Andalucia - Cadiz
  "cadiz",
  "jerez-frontera",
  "algeciras",
  "san-fernando",
  "el-puerto-santa-maria",
  "chiclana-frontera",
  "sanlucar-barrameda",
  "la-linea-concepcion",
  "rota",
  "puerto-real",
  "arcos-frontera",
  "barbate",
  "conil-frontera",
  "tarifa",
  "los-barrios",
  "san-roque",
  "jimena-frontera",
  "ubrique",
  "villamartin",
  "zahara-atunes",
  "bolonia",
  "vejer-frontera",
  "medina-sidonia",
  // Andalucia - Almeria
  "almeria",
  "el-ejido",
  "roquetas-mar",
  "nijar",
  "aguadulce",
  "la-mojonera",
  "adra",
  "berja",
  "dalias",
  "vicar",
  "huercal-overa",
  "cuevas-almanzora",
  "vera",
  "mojacar",
  "garrucha",
  "carboneras",
  "agua-amarga",
  "san-jose",
  "cabo-gata",
  "retamar",
  "costacabana",
  "almerimar",
  // Andalucia - Huelva
  "huelva",
  "lepe",
  "almonte",
  "isla-cristina",
  "ayamonte",
  "moguer",
  "cartaya",
  "punta-umbria",
  "aljaraque",
  "san-juan-puerto",
  "bollullos-condado",
  "palma-condado",
  "matalascanas",
  "mazagon",
  "el-rocio",
  "palos-frontera",
  // Andalucia - Jaen
  "jaen",
  "linares",
  "andujar",
  "ubeda",
  "baeza",
  "martos",
  "alcala-real",
  "torre-campo",
  "la-carolina",
  "jodar",
  "mancha-real",
  "villacarrillo",
  "cazorla",
  "quesada",
  "peal-becerro",
  // Valencia
  "valencia",
  "torrent",
  "gandia",
  "paterna",
  "sagunto",
  "mislata",
  "burjassot",
  "ontinyent",
  "aldaia",
  "manises",
  "alfafar",
  "quart-poblet",
  "xirivella",
  "catarroja",
  "alaquas",
  "sueca",
  "cullera",
  "alzira",
  "xativa",
  "oliva",
  "denia",
  "javea",
  "calpe",
  "altea",
  "benidorm",
  "villajoyosa",
  "el-campello",
  "sant-joan-alacant",
  "mutxamel",
  "san-vicente-raspeig",
  "novelda",
  "elda",
  "petrer",
  "villena",
  "ibi",
  "castalla",
  "onil",
  "biar",
  "alcoy",
  "picanya",
  "paiporta",
  "benetusser",
  "sedavi",
  "massanassa",
  "albal",
  "silla",
  "almussafes",
  "benifaio",
  "algemesi",
  "carcaixent",
  "la-pobla-llarga",
  "tavernes-valldigna",
  "xeraco",
  "playa-gandia",
  "grau-gandia",
  "miramar",
  "piles",
  "guardamar-safor",
  "bellreguard",
  "palmera",
  "rafelcofer",
  "potries",
  "beniarjo",
  "real-gandia",
  "benifla",
  // Alicante
  "alicante",
  "elche",
  "torrevieja",
  "orihuela",
  "alcoy",
  "san-vicente-raspeig",
  "denia",
  "javea",
  "calpe",
  "altea",
  "alfaz-pi",
  "la-nucia",
  "polop",
  "callosa-ensarria",
  "guadalest",
  "el-campello",
  "santa-pola",
  "guardamar-segura",
  "rojales",
  "pilar-horadada",
  "san-miguel-salinas",
  "los-montesinos",
  "algorfa",
  "benitachell",
  "teulada",
  "moraira",
  "benissa",
  "gata-gorgos",
  "pedreguer",
  "ondara",
  "vergel",
  "els-poblets",
  "pego",
  "murla",
  "parcent",
  "alcalali",
  "jalon",
  "lliber",
  "senija",
  "benidoleig",
  "tormos",
  "sagra",
  "rafol-almunia",
  "beniarbeig",
  "el-verger",
  // Castellon
  "castellon-plana",
  "vila-real",
  "burriana",
  "vinaros",
  "benicarlo",
  "onda",
  "la-vall-uixo",
  "almassora",
  "benicassim",
  "oropesa-mar",
  "peniscola",
  "alcossebre",
  "torreblanca",
  "cabanes",
  "vall-alba",
  "benlloch",
  // Pais Vasco
  "bilbao",
  "barakaldo",
  "getxo",
  "portugalete",
  "santurtzi",
  "basauri",
  "leioa",
  "galdakao",
  "durango",
  "erandio",
  "sestao",
  "ermua",
  "eibar",
  "gernika-lumo",
  "bermeo",
  "lekeitio",
  "ondarroa",
  "markina-xemein",
  "mungia",
  "plentzia",
  "gorliz",
  "sopela",
  "berango",
  "algorta",
  "las-arenas",
  "san-sebastian",
  "irun",
  "errenteria",
  "zarautz",
  "hernani",
  "tolosa",
  "hondarribia",
  "arrasate",
  "bergara",
  "azpeitia",
  "azkoitia",
  "beasain",
  "zumaia",
  "getaria",
  "deba",
  "mutriku",
  "vitoria-gasteiz",
  "llodio",
  "amurrio",
  "salvatierra",
  // Galicia
  "a-coruna",
  "santiago-compostela",
  "ferrol",
  "naron",
  "oleiros",
  "arteixo",
  "carballo",
  "ribeira",
  "culleredo",
  "cambre",
  "betanzos",
  "sada",
  "cedeira",
  "pontedeume",
  "neda",
  "fene",
  "mugardos",
  "ares",
  "mino",
  "bergondo",
  "vigo",
  "pontevedra",
  "vilagarcia-arousa",
  "redondela",
  "cangas",
  "marin",
  "moana",
  "nigran",
  "baiona",
  "sanxenxo",
  "o-grove",
  "cambados",
  "ribadumia",
  "meis",
  "poio",
  "bueu",
  "gondomar",
  "mos",
  "porrino",
  "tui",
  "a-guarda",
  "ourense",
  "verin",
  "o-barco-valdeorras",
  "carballino",
  "xinzo-limia",
  "lugo",
  "monforte-lemos",
  "viveiro",
  "vilalba",
  "ribadeo",
  "foz",
  "burela",
  // Murcia
  "murcia",
  "cartagena",
  "lorca",
  "molina-segura",
  "alcantarilla",
  "mazarron",
  "aguilas",
  "cieza",
  "yecla",
  "jumilla",
  "totana",
  "alhama-murcia",
  "torre-pacheco",
  "san-javier",
  "san-pedro-pinatar",
  "los-alcazares",
  "la-manga",
  "la-union",
  "archena",
  "las-torres-cotillas",
  "santomera",
  "fortuna",
  "abanilla",
  "bullas",
  "caravaca-cruz",
  "calasparra",
  "moratalla",
  "cehegin",
  "mula",
  "alguazas",
  "ceutí",
  "lorqui",
  "villanueva-segura",
  "ojos",
  "ricote",
  // Aragon
  "zaragoza",
  "calatayud",
  "utebo",
  "ejea-caballeros",
  "tarazona",
  "zuera",
  "la-almunia-dona-godina",
  "caspe",
  "borja",
  "illueca",
  "carinena",
  "huesca",
  "monzon",
  "barbastro",
  "fraga",
  "jaca",
  "sabiñanigo",
  "binefar",
  "teruel",
  "alcaniz",
  "andorra",
  "calamocha",
  "utrillas",
  "montalban",
  // Baleares
  "palma-mallorca",
  "calvia",
  "inca",
  "manacor",
  "llucmajor",
  "marratxi",
  "alcudia",
  "pollença",
  "soller",
  "andratx",
  "santa-ponsa",
  "paguera",
  "magaluf",
  "palma-nova",
  "illetas",
  "portals-nous",
  "puerto-pollensa",
  "can-picafort",
  "cala-millor",
  "cala-ratjada",
  "porto-cristo",
  "santanyi",
  "colonia-sant-jordi",
  "cala-dor",
  "portocolom",
  "felanitx",
  "campos",
  "ibiza",
  "sant-antoni-portmany",
  "santa-eulalia-riu",
  "sant-josep-talaia",
  "sant-joan-labritja",
  "playa-den-bossa",
  "cala-llonga",
  "san-carlos",
  "mahon",
  "ciutadella",
  "es-castell",
  "alaior",
  "ferreries",
  // Canarias
  "las-palmas-gran-canaria",
  "telde",
  "santa-lucia-tirajana",
  "arucas",
  "san-bartolome-tirajana",
  "aguimes",
  "ingenio",
  "mogan",
  "galdar",
  "teror",
  "vecindario",
  "playa-ingles",
  "maspalomas",
  "puerto-rico",
  "arguineguin",
  "santa-cruz-tenerife",
  "la-laguna",
  "arona",
  "adeje",
  "la-orotava",
  "granadilla-abona",
  "los-realejos",
  "puerto-cruz",
  "icod-vinos",
  "candelaria",
  "guimar",
  "tacoronte",
  "los-cristianos",
  "playa-americas",
  "costa-adeje",
  // Castilla y Leon
  "valladolid",
  "burgos",
  "salamanca",
  "leon",
  "palencia",
  "zamora",
  "segovia",
  "avila",
  "soria",
  "ponferrada",
  "miranda-ebro",
  "aranda-duero",
  "medina-campo",
  "laguna-duero",
  "benavente",
  "astorga",
  "la-bañeza",
  "bembibre",
  // Castilla-La Mancha
  "toledo",
  "albacete",
  "ciudad-real",
  "guadalajara",
  "cuenca",
  "talavera-reina",
  "puertollano",
  "tomelloso",
  "alcazar-san-juan",
  "hellin",
  "almansa",
  "villarrobledo",
  "valdepenas",
  "manzanares",
  "daimiel",
  "alcantara",
  // Asturias
  "oviedo",
  "gijon",
  "aviles",
  "siero",
  "langreo",
  "mieres",
  "castrillon",
  "san-martin-rey-aurelio",
  "laviana",
  "llanes",
  "ribadesella",
  "cangas-onis",
  "villaviciosa",
  "nava",
  "arriondas",
  "infiesto",
  "cangas-narcea",
  "tineo",
  // Cantabria
  "santander",
  "torrelavega",
  "castro-urdiales",
  "camargo",
  "piélagos",
  "el-astillero",
  "laredo",
  "santoña",
  "noja",
  "suances",
  "comillas",
  "san-vicente-barquera",
  "santillana-mar",
  "potes",
  "reinosa",
  "ramales-victoria",
  // Navarra
  "pamplona",
  "tudela",
  "barañain",
  "burlada",
  "estella-lizarra",
  "tafalla",
  "zizur-mayor",
  "villava",
  "ansoain",
  "berriozar",
  "alsasua",
  "sangüesa",
  "olite",
  "peralta",
  // La Rioja
  "logroño",
  "calahorra",
  "arnedo",
  "haro",
  "najera",
  "alfaro",
  "lardero",
  "santo-domingo-calzada",
  "nájera",
  // Extremadura
  "badajoz",
  "caceres",
  "merida",
  "plasencia",
  "don-benito",
  "almendralejo",
  "villanueva-serena",
  "zafra",
  "montijo",
  "navalmoral-mata",
  "trujillo",
  "coria",
  "villanueva-fresno",
  "jerez-caballeros",
  "olivenza",
  "villafranca-barros",
]

const MODIFIERS = [
  "",
  "-urgente",
  "-24-horas",
  "-economico",
  "-barato",
  "-a-domicilio",
  "-cerca-de-mi",
  "-de-guardia",
  "-nocturno",
  "-festivos",
  "-rapido",
  "-ahora",
  "-hoy",
  "-profesional",
  "-de-confianza",
  "-con-garantia",
  "-mismo-dia",
  "-fin-de-semana",
]

const PROBLEMS: Record<string, string[]> = {
  electricista: [
    "apagon",
    "cortocircuito",
    "olor-quemado",
    "diferencial-salta",
    "enchufes-no-funcionan",
    "luces-parpadean",
    "cuadro-electrico",
    "instalacion-electrica",
    "boletin-electrico",
    "subida-tension",
    "bajada-tension",
    "cable-quemado",
    "enchufe-fundido",
    "interruptor-roto",
    "lampara-no-enciende",
    "fusible-fundido",
  ],
  fontanero: [
    "fuga-agua",
    "tuberia-rota",
    "inundacion",
    "atasco-grave",
    "grifo-gotea",
    "cisterna-no-funciona",
    "calentador",
    "humedad",
    "bajante-roto",
    "arqueta-atascada",
    "bomba-agua",
    "presion-agua-baja",
    "agua-sucia",
    "sifon-atascado",
    "desague-lento",
    "tuberia-congelada",
  ],
  cerrajero: [
    "puerta-bloqueada",
    "cerradura-rota",
    "llave-dentro",
    "robo",
    "cambio-cerradura",
    "copia-llaves",
    "cerradura-seguridad",
    "puerta-blindada",
    "cerrojo-atascado",
    "llave-rota-cerradura",
    "apertura-urgente",
    "bombin-roto",
    "manilla-rota",
    "puerta-no-cierra",
  ],
  desatascos: [
    "wc-atascado",
    "fregadero-atascado",
    "arqueta-atascada",
    "mal-olor",
    "ducha-atascada",
    "bajante-atascado",
    "limpieza-tuberias",
    "poceria",
    "fosa-septica",
    "alcantarillado",
    "inspeccion-camara",
    "raices-tuberia",
    "grasa-tuberia",
    "bañera-atascada",
  ],
  calderas: [
    "sin-agua-caliente",
    "caldera-no-enciende",
    "fuga-gas",
    "ruido-caldera",
    "revision-caldera",
    "cambio-caldera",
    "radiadores",
    "calefaccion-no-funciona",
    "termo-electrico",
    "calentador-gas",
    "presion-caldera",
    "piloto-apagado",
    "caldera-pierde-agua",
    "caldera-error",
  ],
}

const PROFESSION_SLUGS = ["electricista", "fontanero", "cerrajero", "desatascos", "calderas"]

export async function GET(request: Request, { params }: { params: Promise<{ slug: string[] }> }) {
  try {
    const { slug } = await params
    const baseUrl = "https://rapidfix.es"
    const date = new Date().toISOString().split("T")[0]

    const rawId = slug.join("/")
    const id = rawId.endsWith(".xml") ? rawId.slice(0, -4) : rawId

    const urls: string[] = []

    if (id.endsWith("-problemas")) {
      const profession = id.replace("-problemas", "")
      const problems = PROBLEMS[profession] || []
      for (const problem of problems) {
        for (const city of CITIES) {
          urls.push(`${baseUrl}/problema/${profession}/${problem}/${city}`)
        }
      }
    } else if (id.startsWith("precio-") || id.startsWith("presupuesto-")) {
      const prefix = id.startsWith("precio-") ? "precio-" : "presupuesto-"
      const profession = id.replace(prefix, "")
      for (const city of CITIES) {
        urls.push(`${baseUrl}/${prefix}${profession}/${city}`)
      }
    } else {
      let profession = ""
      let modifier = ""

      for (const p of PROFESSION_SLUGS) {
        if (id === p) {
          profession = p
          break
        }
        for (const mod of MODIFIERS) {
          if (mod && id === `${p}${mod}`) {
            profession = p
            modifier = mod
            break
          }
        }
        if (profession) break
      }

      if (profession) {
        for (const city of CITIES) {
          if (modifier) {
            urls.push(`${baseUrl}/${profession}${modifier}/${city}`)
          } else {
            urls.push(`${baseUrl}/${profession}/${city}`)
          }
        }
      }
    }

    let xml = '<?xml version="1.0" encoding="UTF-8"?>\n'
    xml += '<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n'

    for (const url of urls) {
      xml += `  <url>\n`
      xml += `    <loc>${url}</loc>\n`
      xml += `    <lastmod>${date}</lastmod>\n`
      xml += `    <changefreq>weekly</changefreq>\n`
      xml += `    <priority>0.8</priority>\n`
      xml += `  </url>\n`
    }

    xml += "</urlset>"

    return new NextResponse(xml, {
      headers: {
        "Content-Type": "application/xml",
        "Cache-Control": "public, max-age=86400",
      },
    })
  } catch (error) {
    const xml =
      '<?xml version="1.0" encoding="UTF-8"?>\n<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n</urlset>'
    return new NextResponse(xml, {
      headers: { "Content-Type": "application/xml" },
    })
  }
}
